r1<- c(0,0,1,1,0,0,0,0,0,-1,0,-1,-1,0,0,0,-1,0,0,0,0,-1,0)
r2<-c(1,0,-1,0,1,rep(0,18))
r3<-c(0,-1,rep(0,8),1,rep(0,11),1)
r4<-c(rep(0,9),1,rep(0,4),-1,rep(0,8))
r5<-c(rep(0,6),-1,rep(0,16))
r6<-c(rep(0,18),-1,rep(0,4))
r7<-c(rep(0,4),-1,rep(0,8),1,rep(0,9))
r8<-c(rep(0,5),-1,0,-1,-1,0,-1,1,0,-1,rep(0,9))
r9<-c(rep(0,5),1,rep(0,16),-1)
r10<-c(rep(0,15),-1,1,rep(0,6))
r11<-c(rep(0,7),1,rep(0,15))
r12<-c(0,0,0,-1,rep(0,19))
r13<-c(rep(0,17),-1,rep(0,5))
r14<-c(rep(0,12),1,rep(0,6),-1,-1,0,0)
r15<-c(-1,rep(0,22))
r16<-c(0,1,rep(0,21))
r17<-c(rep(0,8),1,rep(0,5),1,rep(0,8))
r18<-c(rep(0,6),1,rep(0,8),1,rep(0,4),1,0,0)
r19<-c(rep(0,17),1,1,1,0,0,0)
r20<-c(rep(0,21),1,0)
A<-rbind(r1,r2,r3,r4,r5,r6,r7,r8,r9,r10,r11,r12,r13,r14,r15,r16,r17,r18,r19,r20);A

n1<-c(0,0,1,0,1,rep(0,6),1,0,1,rep(0,9))
n2<-c(rep(0,8),-1,1,0,-1,0,0,1,rep(0,8))
n3<-c(rep(0,12),-1,0,0,1,1,0,0,0,-1,0,0)
n4<-c(rep(0,5),1,rep(0,4),-1,rep(0,11),1)
N<-rbind(n1,n2,n3,n4);N

A%*%t(N)

yP<-matrix(c(12321,10337,0,269,-12571,0,159,-15,3270,-1075,9499,0,677,-12717,-1078,58,0,-6,60,56,715,36,140),ncol=1);yP
X<-matrix(c(631,-250,-698,3,-159,-60,-146,-37,-140,-58,-15,-269,6,-94,-12321,10337,2192,932,110,36),ncol=1);X

round(A%*%yP,0)==X
yN<-t(N)%*%solve(N%*%t(N))%*%N%*%yP;yN
round(A%*%yN,0)==0
yR<-yP-t(N)%*%solve(N%*%t(N))%*%N%*%yP;yR
round(A%*%yR,0)==X
round(N%*%yR,0)==0
mu<-matrix(c(14745,11602,89,38,0,35,3,0,3000,0,8000,12,400,-51,0,60,2,5,320,0,15,795,100),ncol=1);mu
Ao<-A[-20,];Ao
Xo<-X[-20,];Xo
Pr<-round(t(Ao)%*%solve(Ao%*%t(Ao))%*%Ao,2);Pr
Pn<-round(t(N)%*%solve(N%*%t(N))%*%N,2);Pn
yT<-Pn%*%mu+Pr%*%yP;yT
round(A%*%yT,0)==X
round(Ao%*%yP,0)==Xo
SSE<-t(yP-mu)%*%(yP-mu);SSE
Var<-(SSE/23);Var
V<-diag(drop(Var),nrow=23);V
Vyx<-V%*%t(Ao)
Vxy<-Ao%*%V
Vxx<-Ao%*%V%*%t(Ao)
mu+Vyx%*%solve(Vxx)%*%Ao%*%(yP-mu)

round(V-Vyx%*%solve(Vxx)%*%Vxy,0)

